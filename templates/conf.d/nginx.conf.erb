user <%= scope.lookupvar('nginx::config::nx_daemon_user') %>;
worker_processes <%= worker_processes %>;

error_log  <%= scope.lookupvar('nginx::params::nx_logdir')%>/error.log;
pid        <%= scope.lookupvar('nginx::params::nx_pid')%>;

events {
  worker_connections <%= worker_connections %>;
  <% if scope.lookupvar('nginx::params::nx_multi_accept') == 'on' %>multi_accept on;<% end %>
}

http {
  include       /etc/nginx/mime.types;
  default_type  application/octet-stream;

  access_log  <%= scope.lookupvar('nginx::params::nx_logdir')%>/access.log;

  sendfile    <%= scope.lookupvar('nginx::params::nx_sendfile')%>;

  <% if scope.lookupvar('nginx::params::nx_tcp_nopush') == 'on' %>
  tcp_nopush  on;
  <% end %>

  keepalive_timeout  <%= keepalive_timeout %>;
  tcp_nodelay        <%= scope.lookupvar('nginx::params::nx_tcp_nodelay')%>;

  <% if scope.lookupvar('nginx::params::nx_gzip') == 'on' %> 
  gzip         on;
  gzip_proxied any;
  gzip_disable "MSIE [1-6]\.(?!.*SV1)";
  gzip_types   "text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript image/svg+xml";
  gzip_vary    on;
  <% end %>

  <% if @geoip_dat_destination %>
  <%= geoip_dat_type %> <%= geoip_dat_destination %>;
  <% end -%>

  <% if @real_ip_header %>
  real_ip_header     <%= real_ip_header %>;
  <% end -%>
  <% if @real_ips %><% real_ips.each do |ip| -%> 
  set_real_ip_from   <%= ip %>;<% end %>
  <% end %>
  include /etc/nginx/conf.d/*.conf;
  include /etc/nginx/vhost_autogen.conf;
}
